{"version":3,"file":"index.umd.js","sources":["../../../../src/composables/useModalController/index.ts"],"sourcesContent":["import {\n  type ComponentInternalInstance,\n  computed,\n  getCurrentInstance,\n  inject,\n  ref,\n  toValue,\n} from 'vue'\nimport {modalControllerPluginKey} from '../../utils/keys'\nimport type {\n  ControllerKey,\n  PromiseWithModal,\n  PromiseWithModalBoolean,\n} from '../../types/ComponentOrchestratorTypes'\nimport {useSharedModalStack} from '../../composables/useModalManager'\n\nexport const useModalController = () => {\n  const noopPromise = () => {\n    // eslint-disable-next-line no-console\n    console.warn(\n      'useModalController() was called outside of the setup() function! or the plugin is not provided.'\n    )\n    return Promise.resolve(null) as unknown as PromiseWithModal\n  }\n  const modalControllerPlugin = inject(modalControllerPluginKey, {\n    modals: ref(new Map()),\n    _isOrchestratorInstalled: ref(false),\n    create: noopPromise,\n    show: noopPromise as () => PromiseWithModalBoolean,\n    confirm: noopPromise as () => PromiseWithModalBoolean,\n  })\n  if (modalControllerPlugin.create === noopPromise) {\n    throw Error(\n      'useModalController() was called outside of the setup() function! or the plugin is not provided.'\n    )\n  }\n\n  const {lastStack, stack, registry} = useSharedModalStack()\n  const hide = (trigger?: string, id?: ControllerKey) => {\n    if (id === undefined) {\n      if (id === undefined && lastStack?.value) {\n        lastStack?.value.exposed?.hide(trigger)\n      }\n    } else {\n      const stackModal = stack?.value.find((modal) => modal.exposed?.id === id)\n      if (stackModal) {\n        stackModal.exposed?.hide(trigger)\n        return\n      }\n      const modal = modalControllerPlugin.modals.value.get(id)\n      if (modal) {\n        modal.modelValue = false\n        modal['onUpdate:modelValue']?.(false)\n      } else {\n        stack?.value.forEach((modal) => {\n          if (modal.exposed?.id === id) {\n            modal.exposed?.hide(trigger, true)\n          }\n        })\n      }\n    }\n  }\n\n  const hideAll = (trigger?: string) => {\n    stack?.value.forEach((modal) => {\n      modal.exposed?.hide(trigger, true)\n    })\n  }\n\n  const get = (id: ControllerKey) => {\n    if (modalControllerPlugin.modals.value.get(id)) {\n      const modal = modalControllerPlugin.modals.value.get(id)\n      return {\n        modal,\n        show() {\n          modal?.promise.value.show()\n        },\n        hide(trigger?: string) {\n          modal?.promise.value.hide(trigger)\n        },\n      }\n    }\n    if (registry?.value) {\n      for (const [, modal] of registry?.value.entries() ?? []) {\n        if (toValue(modal.exposed?.id) === id) {\n          return {\n            modal,\n            show() {\n              modal.exposed?.show()\n            },\n            hide(trigger?: string) {\n              modal.exposed?.hide(trigger, true)\n            },\n          }\n        }\n      }\n    }\n    return null\n  }\n\n  const instance = getCurrentInstance()\n  const current = () => {\n    const findBModal = (component: ComponentInternalInstance): ComponentInternalInstance | null => {\n      if (!component.parent) {\n        return null\n      }\n      if (component.parent.type.__name === 'BModal') {\n        return component.parent\n      }\n      return findBModal(component.parent)\n    }\n    if (!instance) {\n      return null\n    }\n    const modalComponent = computed(() => findBModal(instance))\n    const modal = computed(() => modalComponent.value?.proxy)\n    return {\n      show() {\n        modalComponent.value?.exposed?.show()\n      },\n      hide(trigger?: string) {\n        modalComponent.value?.exposed?.hide(trigger, true)\n      },\n      modal,\n    }\n  }\n\n  return {\n    hide,\n    hideAll,\n    get,\n    current,\n    ...modalControllerPlugin,\n    // Todo: Supports listening events globally in the future\n  }\n}\n"],"names":["noopPromise","console","warn","Promise","resolve","modalControllerPlugin","inject","modalControllerPluginKey","modals","ref","Map","_isOrchestratorInstalled","create","show","confirm","Error","lastStack","stack","registry","useSharedModalStack","instance","getCurrentInstance","hide","trigger","id","value","_a","exposed","stackModal","find","modal","_b","get","modelValue","_c","call","forEach","hideAll","promise","entries","toValue","current","findBModal","component","parent","type","__name","modalComponent","computed","proxy"],"mappings":"2NAgBkC,KAChC,MAAMA,EAAc,KAEVC,QAAAC,KACN,mGAEKC,QAAQC,QAAQ,OAEnBC,EAAwBC,SAAOC,2BAA0B,CAC7DC,OAAQC,EAAAA,IAAQ,IAAAC,KAChBC,yBAA0BF,OAAI,GAC9BG,OAAQZ,EACRa,KAAMb,EACNc,QAASd,IAEP,GAAAK,EAAsBO,SAAWZ,EAC7B,MAAAe,MACJ,mGAIJ,MAAMC,UAACA,EAAWC,MAAAA,EAAAC,SAAOA,GAAYC,EAAAA,sBA+D/BC,EAAWC,EAAAA,qBA2BV,MAAA,CACLC,KA1FW,CAACC,EAAkBC,eAC9B,QAAW,IAAPA,OACS,IAAPA,IAAoB,MAAAR,OAAA,EAAAA,EAAWS,SACtB,OAAAC,EAAA,MAAAV,OAAA,EAAAA,EAAAS,MAAME,UAAND,EAAeJ,KAAKC,QAE5B,CACC,MAAAK,EAAa,MAAAX,OAAA,EAAAA,EAAOQ,MAAMI,MAAMC,UAAUA,OAAAA,OAAAA,EAAAA,EAAMH,cAANG,EAAAA,EAAeN,MAAOA,CAAA,IACtE,GAAII,EAEF,YADW,OAAAG,EAAAH,EAAAD,YAASL,KAAKC,IAG3B,MAAMO,EAAQzB,EAAsBG,OAAOiB,MAAMO,IAAIR,GACjDM,GACFA,EAAMG,YAAa,EACb,OAAAC,EAAAJ,EAAA,yBAAyBI,EAAAC,KAAAL,GAAA,IAExB,MAAAb,GAAAA,EAAAQ,MAAMW,SAASN,aAChBA,OAAAA,EAAAA,EAAMH,cAANG,EAAAA,EAAeN,MAAOA,IACxBM,OAAAA,EAAAA,EAAMH,UAANG,EAAeR,KAAKC,GAAS,GAAI,GAGvC,GAsEFc,QAlEed,IACR,MAAAN,GAAAA,EAAAQ,MAAMW,SAASN,UACd,OAAAJ,EAAAI,EAAAH,UAASD,EAAAJ,KAAKC,GAAS,EAAA,GAAI,EAiEnCS,IA7DWR,UACX,GAAInB,EAAsBG,OAAOiB,MAAMO,IAAIR,GAAK,CAC9C,MAAMM,EAAQzB,EAAsBG,OAAOiB,MAAMO,IAAIR,GAC9C,MAAA,CACLM,QACA,IAAAjB,GACS,MAAAiB,GAAAA,EAAAQ,QAAQb,MAAMZ,MACvB,EACA,IAAAS,CAAKC,GACI,MAAAO,GAAAA,EAAAQ,QAAQb,MAAMH,KAAKC,EAAO,EAErC,CAEF,SAAIL,WAAUO,MACD,IAAA,MAAG,CAAAK,WAAUZ,WAAUO,MAAMc,YAAa,GACnD,GAAIC,EAAQA,QAAA,OAAAd,EAAAI,EAAMH,cAAS,EAAAD,EAAAF,MAAQA,EAC1B,MAAA,CACLM,QACA,IAAAjB,SACE,OAAAa,EAAAI,EAAMH,UAAND,EAAeb,MACjB,EACA,IAAAS,CAAKC,SACG,OAAAG,EAAAI,EAAAH,UAAAD,EAASJ,KAAKC,GAAS,EAAI,GAMpC,OAAA,IAAA,EAkCPkB,QA9Bc,KACR,MAAAC,EAAcC,GACbA,EAAUC,OAGsB,WAAjCD,EAAUC,OAAOC,KAAKC,OACjBH,EAAUC,OAEZF,EAAWC,EAAUC,QALnB,KAOX,IAAKxB,EACI,OAAA,KAET,MAAM2B,EAAiBC,EAAAA,UAAS,IAAMN,EAAWtB,KAC3CU,EAAQkB,EAAAA,UAAS,WAAM,OAAA,OAAAtB,EAAAqB,EAAetB,YAAO,EAAAC,EAAAuB,KAAA,IAC5C,MAAA,CACL,IAAApC,WACiB,OAAAkB,EAAA,OAAAL,EAAAqB,EAAAtB,YAAO,EAAAC,EAAAC,UAASI,EAAAlB,MACjC,EACA,IAAAS,CAAKC,WACH,OAAAQ,EAAA,OAAAL,EAAAqB,EAAetB,YAAf,EAAAC,EAAsBC,UAAtBI,EAA+BT,KAAKC,GAAS,EAC/C,EACAO,QACF,KAQGzB,EAEL"}